<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Elements of a Function | Code Development in Model Infrastructure</title>
  <meta name="description" content="A general discussion of the current coding practices followed by the Model Infrastructure Team." />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Elements of a Function | Code Development in Model Infrastructure" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A general discussion of the current coding practices followed by the Model Infrastructure Team." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Elements of a Function | Code Development in Model Infrastructure" />
  
  <meta name="twitter:description" content="A general discussion of the current coding practices followed by the Model Infrastructure Team." />
  

<meta name="author" content="Leigh Alexander and Shannon T. Holloway" />


<meta name="date" content="2025-04-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="extended-function-example.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="Functions.html"><a href="Functions.html"><i class="fa fa-check"></i><b>1</b> Elements of a Function</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Functions.html"><a href="Functions.html#function-structure"><i class="fa fa-check"></i><b>1.1</b> Function Structure</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="Functions.html"><a href="Functions.html#usage-definition"><i class="fa fa-check"></i><b>1.1.1</b> Usage definition</a></li>
<li class="chapter" data-level="1.1.2" data-path="Functions.html"><a href="Functions.html#input-testing"><i class="fa fa-check"></i><b>1.1.2</b> Input Testing</a></li>
<li class="chapter" data-level="1.1.3" data-path="Functions.html"><a href="Functions.html#input-processing"><i class="fa fa-check"></i><b>1.1.3</b> Input Processing</a></li>
<li class="chapter" data-level="1.1.4" data-path="Functions.html"><a href="Functions.html#task-implementation"><i class="fa fa-check"></i><b>1.1.4</b> Task Implementation</a></li>
<li class="chapter" data-level="1.1.5" data-path="Functions.html"><a href="Functions.html#result-construction-and-testing"><i class="fa fa-check"></i><b>1.1.5</b> Result Construction and Testing</a></li>
<li class="chapter" data-level="1.1.6" data-path="Functions.html"><a href="Functions.html#concluding-remarks"><i class="fa fa-check"></i><b>1.1.6</b> Concluding Remarks</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="extended-function-example.html"><a href="extended-function-example.html"><i class="fa fa-check"></i><b>2</b> Extended Function Example</a>
<ul>
<li class="chapter" data-level="2.1" data-path="extended-function-example.html"><a href="extended-function-example.html#procedure-specification"><i class="fa fa-check"></i><b>2.1</b> Procedure Specification</a></li>
<li class="chapter" data-level="2.2" data-path="extended-function-example.html"><a href="extended-function-example.html#select-a-design"><i class="fa fa-check"></i><b>2.2</b> Select a Design</a></li>
<li class="chapter" data-level="2.3" data-path="extended-function-example.html"><a href="extended-function-example.html#s3-based-design-structure"><i class="fa fa-check"></i><b>2.3</b> S3 Based Design Structure</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="extended-function-example.html"><a href="extended-function-example.html#usage-specification"><i class="fa fa-check"></i><b>2.3.1</b> Usage Specification</a></li>
<li class="chapter" data-level="2.3.2" data-path="extended-function-example.html"><a href="extended-function-example.html#input-testing-1"><i class="fa fa-check"></i><b>2.3.2</b> Input Testing</a></li>
<li class="chapter" data-level="2.3.3" data-path="extended-function-example.html"><a href="extended-function-example.html#input-processing-1"><i class="fa fa-check"></i><b>2.3.3</b> Input Processing</a></li>
<li class="chapter" data-level="2.3.4" data-path="extended-function-example.html"><a href="extended-function-example.html#task-implementation-1"><i class="fa fa-check"></i><b>2.3.4</b> Task Implementation</a></li>
<li class="chapter" data-level="2.3.5" data-path="extended-function-example.html"><a href="extended-function-example.html#results-construction-and-testing"><i class="fa fa-check"></i><b>2.3.5</b> Results Construction and Testing</a></li>
<li class="chapter" data-level="2.3.6" data-path="extended-function-example.html"><a href="extended-function-example.html#extensions"><i class="fa fa-check"></i><b>2.3.6</b> Extensions</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="extended-function-example.html"><a href="extended-function-example.html#framework-and-utility-function-design-structure"><i class="fa fa-check"></i><b>2.4</b> Framework and Utility Function Design Structure</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="extended-function-example.html"><a href="extended-function-example.html#usage-specification-1"><i class="fa fa-check"></i><b>2.4.1</b> Usage Specification</a></li>
<li class="chapter" data-level="2.4.2" data-path="extended-function-example.html"><a href="extended-function-example.html#input-testing-2"><i class="fa fa-check"></i><b>2.4.2</b> Input Testing</a></li>
<li class="chapter" data-level="2.4.3" data-path="extended-function-example.html"><a href="extended-function-example.html#input-processing-2"><i class="fa fa-check"></i><b>2.4.3</b> Input Processing</a></li>
<li class="chapter" data-level="2.4.4" data-path="extended-function-example.html"><a href="extended-function-example.html#task-implementation-2"><i class="fa fa-check"></i><b>2.4.4</b> Task Implementation</a></li>
<li class="chapter" data-level="2.4.5" data-path="extended-function-example.html"><a href="extended-function-example.html#results-construction-and-testing-1"><i class="fa fa-check"></i><b>2.4.5</b> Results Construction and Testing</a></li>
<li class="chapter" data-level="2.4.6" data-path="extended-function-example.html"><a href="extended-function-example.html#extensions-1"><i class="fa fa-check"></i><b>2.4.6</b> Extensions</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="extended-function-example.html"><a href="extended-function-example.html#key-design-differences"><i class="fa fa-check"></i><b>2.5</b> Key Design Differences</a></li>
<li class="chapter" data-level="2.6" data-path="extended-function-example.html"><a href="extended-function-example.html#blended-design"><i class="fa fa-check"></i><b>2.6</b> Blended Design</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="unit-testing.html"><a href="unit-testing.html"><i class="fa fa-check"></i><b>3</b> Unit Testing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="unit-testing.html"><a href="unit-testing.html#general-comments-1"><i class="fa fa-check"></i><b>3.1</b> General Comments</a></li>
<li class="chapter" data-level="3.2" data-path="unit-testing.html"><a href="unit-testing.html#unit-tests-for-chapter-2-example"><i class="fa fa-check"></i><b>3.2</b> Unit Tests for Chapter 2 Example</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="unit-testing.html"><a href="unit-testing.html#common-functions-1"><i class="fa fa-check"></i><b>3.2.1</b> Common Functions</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="unit-testing.html"><a href="unit-testing.html#s3-based-design"><i class="fa fa-check"></i><b>3.3</b> S3 Based Design</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="unit-testing.html"><a href="unit-testing.html#s3-extensions-1"><i class="fa fa-check"></i><b>3.3.1</b> S3 Extensions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pull-request-pr-peer-review.html"><a href="pull-request-pr-peer-review.html"><i class="fa fa-check"></i><b>4</b> Pull Request (PR) Peer Review</a>
<ul>
<li class="chapter" data-level="4.1" data-path="pull-request-pr-peer-review.html"><a href="pull-request-pr-peer-review.html#pull-request-submission"><i class="fa fa-check"></i><b>4.1</b> Pull Request Submission</a></li>
<li class="chapter" data-level="4.2" data-path="pull-request-pr-peer-review.html"><a href="pull-request-pr-peer-review.html#peer-review-preparation"><i class="fa fa-check"></i><b>4.2</b> Peer Review Preparation</a></li>
<li class="chapter" data-level="4.3" data-path="pull-request-pr-peer-review.html"><a href="pull-request-pr-peer-review.html#map-out-your-own-approach"><i class="fa fa-check"></i><b>4.3</b> Map Out Your Own Approach</a></li>
<li class="chapter" data-level="4.4" data-path="pull-request-pr-peer-review.html"><a href="pull-request-pr-peer-review.html#review-the-proposed-changes"><i class="fa fa-check"></i><b>4.4</b> Review the Proposed Changes</a></li>
<li class="chapter" data-level="4.5" data-path="pull-request-pr-peer-review.html"><a href="pull-request-pr-peer-review.html#discuss-alternative-solutions"><i class="fa fa-check"></i><b>4.5</b> Discuss Alternative Solutions</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org/" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Code Development in Model Infrastructure</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Functions" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">Chapter 1</span> Elements of a Function<a href="Functions.html#Functions" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>A formulaic approach to code development provides a strong foundation for developing readable, robust, and well-tested code. In this chapter, we will describe a basic pattern that can be followed when implementing new tools for or extending the <code>somaverse</code> codebase. There is not “one way” to develop code. The format presented here is not expected to be a one-size-fits-all approach. It is only our intention to present a general framework and highlight the components that, however implemented, are viewed by the authors as critical to any development effort.</p>
<div id="function-structure" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Function Structure<a href="Functions.html#function-structure" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are 5 key components of a function:</p>
<ul>
<li>Usage definition</li>
<li>Input testing</li>
<li>Input processing</li>
<li>Task implementation</li>
<li>Result construction and testing</li>
</ul>
<p>To illustrate each of these sections, we will step through the development of a simple function. The following are the general expectations provided, for example, through a Jira task:</p>
<p>Create a tool that fits a model using a random sampling of a provided dataset. The function</p>
<ul>
<li>accepts as input a formula, a dataset, and a random seed;</li>
<li>obtains a random sample (size 100 with replacement) of the provided data;</li>
<li>uses regression method <code>lm()</code> as implemented by the <code>stats</code> package to obtain parameter estimates based on the sampled dataset; and</li>
<li>returns the <code>lm</code> value object augmented by attributes specifying the kind of random number generator and the seed.</li>
</ul>
<div id="usage-definition" class="section level3 hasAnchor" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Usage definition<a href="Functions.html#usage-definition" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As we will discuss in Chapter 2, there are multiple design options for implementing a new functionality. For the purposes of this section, we will use a single function and save the discussion of extendable tools for Chapter 2.</p>
<p>Currently, the <code>somaverse</code> convention for exported functions is to use camel case for function names, e.g., <code>myNewFunction()</code>. For internal functions, i.e., those that are not made available to the user or reside within a function, use camel case preceded by a dot, e.g., <code>.myInternalFunction()</code>. In contrast, argument names use a dot to separate words rather than camel case, e.g., <code>model.formula</code> or <code>r.seed</code>.</p>
<p>Both function and argument names should clearly indicate their purpose but not be verbose.</p>
<div style="margin-left:0.5in;margin-right:0.5in;border:1px solid blue;padding:0.1in;">
<p>Naming functions and arguments can be a surprisingly difficult task; it can be a balancing act between clarity, length, and convention. As an example of a confusing argument name choice, consider the <code>survival::survfit()</code> function. This function is an S3 method for creating survival curves. The S3 generic is defined to dispatch on argument <code>formula</code> – let’s assume that the original implementation was a simple function developed for formula objects that was later transitioned to an S3 method to allow for other types of objects. If that is the case, the argument name <code>formula</code> for the original function was a clear and concise choice. However, at some point, <code>survfit()</code> was extended to be an S3 method within the <code>survival</code> package to also allow for other object types, i.e., <code>Surv</code>, <code>coxph</code>, <code>matrix</code>, etc. The decision was made to keep the original formal arguments! Thus, <code>formula</code> can now be a formula <strong>OR</strong> a previously fit model, <strong>OR</strong> a matrix, etc.! Further, third-party developers have added methods, e.g., objects of class <code>coxnet</code> defined in package <code>glmnet</code>. In fact, the <code>somaverse</code> has also extended this function to objects of class <code>coxnet2</code>. So the original choice of argument name <code>formula</code> does not well describe all of the types of objects that can be provided by the user. In this case <code>object</code> would have likely been a better choice.</p>
</div>
<p><br></p>
<p><strong>LPT:</strong> Don’t dwell on the function and input argument names in the beginning. Use names that mean something to YOU. Save the naming debate for the final step. At that point you’ll have a clear understanding of exactly what the input arguments mean within your code, how your code may or may not be extendable, etc. Then, discuss those choices with your team and explore the <code>somaverse</code> to identify if there are conventions that should be followed or if there are possible future extensions that might influence the choice.</p>
<p>It is also helpful to avoid using common or vague variable names within your code to minimize the chance that a preferred input argument name coincides with a variable name. For example, say a developer opts to use <code>adat</code> as an input argument and uses <code>data</code> as a variable name within their code. After discussion with the team, they realize that it is more common across the <code>somaverse</code> to use <code>data</code> as the input argument name. Unfortunately, a simple find/replace is not an option as <code>data</code> was used internally and blindly changing names may lead to unexpected consequences. Instead, use more descriptive internal variable names. If you convert the provided data object to a model frame, use for example <code>model_frame</code>.</p>
<p>For our example, we opt to use <code>sampleRegression()</code> as the function name and <code>formula</code>, <code>data</code>, and <code>r.seed</code> as the required input arguments. If, for example, it is anticipated that this function might be extended to allow a covariate matrix and response vector, this choice of input names would not be the best choice.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="Functions.html#cb1-1" tabindex="-1"></a><span class="fu">sampleRegression</span>(formula, data, <span class="at">r.seed =</span> 1234L) {</span>
<span id="cb1-2"><a href="Functions.html#cb1-2" tabindex="-1"></a>  <span class="do">### Input Testing</span></span>
<span id="cb1-3"><a href="Functions.html#cb1-3" tabindex="-1"></a>  <span class="do">### Input Processing</span></span>
<span id="cb1-4"><a href="Functions.html#cb1-4" tabindex="-1"></a>  <span class="do">### Task Implementation</span></span>
<span id="cb1-5"><a href="Functions.html#cb1-5" tabindex="-1"></a>  <span class="do">### Result Construction</span></span>
<span id="cb1-6"><a href="Functions.html#cb1-6" tabindex="-1"></a>}</span></code></pre></div>
<p>Notice that we elected to include a default value for input <code>r.seed</code>. Default values can also be surprisingly tricky to set. For example, the best tolerance bound for converge of an iterative algorithm can vary widely. Default values are often kinder to our users, but care must be taken in selecting the default values and thus the default behaviors.</p>
</div>
<div id="input-testing" class="section level3 hasAnchor" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Input Testing<a href="Functions.html#input-testing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Ensuring that the inputs provided by the user are exactly what you expect them to be is the first step toward developing robust code. Despite our best efforts to provide clear and thorough documentation, we may not always succeed in clarity, users may not read the entire help page, and providing exhaustive examples is often not feasible w.r.t. build times. <strong>The first defense against misuse of code is to ensure that the information provided by the user is what we expect it to be.</strong></p>
<p>Immediately following the usage specification, <strong>ALL</strong> of the inputs should be tested for basic characteristics. Are they the correct types? Do they have the correct dimensions? Are the values within range? This is often most easily accomplished using <code>stopifnot()</code> with clear descriptions of what the correct structure should be. For example,</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="Functions.html#cb2-1" tabindex="-1"></a><span class="fu">sampleRegression</span>(formula, data, <span class="at">r.seed =</span> 1234L) {</span>
<span id="cb2-2"><a href="Functions.html#cb2-2" tabindex="-1"></a>  </span>
<span id="cb2-3"><a href="Functions.html#cb2-3" tabindex="-1"></a>  <span class="do">### Input Testing</span></span>
<span id="cb2-4"><a href="Functions.html#cb2-4" tabindex="-1"></a>  </span>
<span id="cb2-5"><a href="Functions.html#cb2-5" tabindex="-1"></a>  <span class="fu">stopifnot</span>(</span>
<span id="cb2-6"><a href="Functions.html#cb2-6" tabindex="-1"></a>    <span class="st">&quot;`formula` should be of the form LHS ~ RHS.&quot;</span> <span class="ot">=</span></span>
<span id="cb2-7"><a href="Functions.html#cb2-7" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">missing</span>(formula) <span class="sc">&amp;&amp;</span> <span class="fu">inherits</span>(formula, <span class="st">&quot;formula&quot;</span>) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(formula) <span class="sc">==</span> 3L,</span>
<span id="cb2-8"><a href="Functions.html#cb2-8" tabindex="-1"></a>    <span class="st">&quot;`data` should be a data.frame.&quot;</span> <span class="ot">=</span> </span>
<span id="cb2-9"><a href="Functions.html#cb2-9" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">missing</span>(data) <span class="sc">&amp;&amp;</span> <span class="fu">is.data.frame</span>(data),</span>
<span id="cb2-10"><a href="Functions.html#cb2-10" tabindex="-1"></a>    <span class="st">&quot;`r.seed` should be a positive integer.&quot;</span> <span class="ot">=</span> </span>
<span id="cb2-11"><a href="Functions.html#cb2-11" tabindex="-1"></a>      <span class="fu">is.numeric</span>(r.seed) <span class="sc">&amp;&amp;</span> <span class="fu">is.vector</span>(r.seed) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(r.seed) <span class="sc">==</span> 1L <span class="sc">&amp;&amp;</span> </span>
<span id="cb2-12"><a href="Functions.html#cb2-12" tabindex="-1"></a>      r.seed <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">isTRUE</span>(<span class="fu">all.equal</span>(r.seed, <span class="fu">as.integer</span>(r.seed)))</span>
<span id="cb2-13"><a href="Functions.html#cb2-13" tabindex="-1"></a>  )</span>
<span id="cb2-14"><a href="Functions.html#cb2-14" tabindex="-1"></a>  </span>
<span id="cb2-15"><a href="Functions.html#cb2-15" tabindex="-1"></a>  <span class="do">### Input Processing</span></span>
<span id="cb2-16"><a href="Functions.html#cb2-16" tabindex="-1"></a>  <span class="do">### Task Implementation</span></span>
<span id="cb2-17"><a href="Functions.html#cb2-17" tabindex="-1"></a>  <span class="do">### Result Construction</span></span>
<span id="cb2-18"><a href="Functions.html#cb2-18" tabindex="-1"></a>}</span></code></pre></div>
<p>Here, we ensure that the formula is provided and contains both a response variable and model covariates – information that is necessary for any regression tool. We ensure that the data is provided and is a data.frame object. And finally, that the seed for the random number generator is a positive integer. Notice that we do not check that <code>r.seed</code> is provided as we have set a default value.</p>
</div>
<div id="input-processing" class="section level3 hasAnchor" number="1.1.3">
<h3><span class="header-section-number">1.1.3</span> Input Processing<a href="Functions.html#input-processing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once it has been confirmed that the basic structure and contents of the inputs are what we expect in simple terms, we need to perform any non-trivial testing and processing of those inputs before using them to perform the task. Such tests should typically be implemented as early in the function as possible.</p>
<div style="margin-left:0.5in;margin-right:0.5in;border:1px solid blue;padding:0.1in;">
<p>The choice of testing as much as possible before performing any calculations is often kinder to the user – imagine if the first step of a task uses a subset of the inputs to complete a 20 minute calculation and only after that calculation is complete do you realize that the inputs required for the next step are invalid!</p>
</div>
<p><br></p>
<p><strong>Be kind to your users. Identify any issues arising from invalid or unexpected inputs as early as you can, especially if a task is time-consuming.</strong></p>
<p>In our example, such an input processing step might be to convert the provided data.frame into a model frame. This processing step ensures that the data contains all of the required model terms as well as the validity of the formula. We can also include an informative message telling the user if cases with missing data are removed and warn them if the provided data is smaller than the number of samples that we will be taking.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="Functions.html#cb3-1" tabindex="-1"></a><span class="fu">sampleRegression</span>(formula, data, <span class="at">r.seed =</span> 1234L) {</span>
<span id="cb3-2"><a href="Functions.html#cb3-2" tabindex="-1"></a>  </span>
<span id="cb3-3"><a href="Functions.html#cb3-3" tabindex="-1"></a>  <span class="do">### Input Testing</span></span>
<span id="cb3-4"><a href="Functions.html#cb3-4" tabindex="-1"></a>  </span>
<span id="cb3-5"><a href="Functions.html#cb3-5" tabindex="-1"></a>  <span class="fu">stopifnot</span>(</span>
<span id="cb3-6"><a href="Functions.html#cb3-6" tabindex="-1"></a>    <span class="st">&quot;`formula` should be of the form LHS ~ RHS.&quot;</span> <span class="ot">=</span></span>
<span id="cb3-7"><a href="Functions.html#cb3-7" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">missing</span>(formula) <span class="sc">&amp;&amp;</span> <span class="fu">inherits</span>(formula, <span class="st">&quot;formula&quot;</span>) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(formula) <span class="sc">==</span> 3L,</span>
<span id="cb3-8"><a href="Functions.html#cb3-8" tabindex="-1"></a>    <span class="st">&quot;`data` should be a data.frame.&quot;</span> <span class="ot">=</span> </span>
<span id="cb3-9"><a href="Functions.html#cb3-9" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">missing</span>(data) <span class="sc">&amp;&amp;</span> <span class="fu">is.data.frame</span>(data),</span>
<span id="cb3-10"><a href="Functions.html#cb3-10" tabindex="-1"></a>    <span class="st">&quot;`r.seed` should be a positive integer.&quot;</span> <span class="ot">=</span> </span>
<span id="cb3-11"><a href="Functions.html#cb3-11" tabindex="-1"></a>      <span class="fu">is.numeric</span>(r.seed) <span class="sc">&amp;&amp;</span> <span class="fu">is.vector</span>(r.seed) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(r.seed) <span class="sc">==</span> 1L <span class="sc">&amp;&amp;</span> </span>
<span id="cb3-12"><a href="Functions.html#cb3-12" tabindex="-1"></a>      r.seed <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">isTRUE</span>(<span class="fu">all.equal</span>(r.seed, <span class="fu">as.integer</span>(r.seed)))</span>
<span id="cb3-13"><a href="Functions.html#cb3-13" tabindex="-1"></a>  )</span>
<span id="cb3-14"><a href="Functions.html#cb3-14" tabindex="-1"></a>  </span>
<span id="cb3-15"><a href="Functions.html#cb3-15" tabindex="-1"></a>  <span class="do">### Input Processing </span></span>
<span id="cb3-16"><a href="Functions.html#cb3-16" tabindex="-1"></a>  </span>
<span id="cb3-17"><a href="Functions.html#cb3-17" tabindex="-1"></a>  <span class="co"># check to ensure that all required `formula` terms are provided in `data`</span></span>
<span id="cb3-18"><a href="Functions.html#cb3-18" tabindex="-1"></a>  model_frame <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(stats<span class="sc">::</span><span class="fu">model.frame</span>(formula, data, <span class="at">na.action =</span> na.omit),</span>
<span id="cb3-19"><a href="Functions.html#cb3-19" tabindex="-1"></a>                          <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb3-20"><a href="Functions.html#cb3-20" tabindex="-1"></a>                            <span class="fu">stop</span>(<span class="st">&quot;Unable to extract model.frame.</span><span class="sc">\n\t</span><span class="st">&quot;</span>,</span>
<span id="cb3-21"><a href="Functions.html#cb3-21" tabindex="-1"></a>                                 e<span class="sc">$</span>message, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-22"><a href="Functions.html#cb3-22" tabindex="-1"></a>                          })</span>
<span id="cb3-23"><a href="Functions.html#cb3-23" tabindex="-1"></a>  </span>
<span id="cb3-24"><a href="Functions.html#cb3-24" tabindex="-1"></a>  <span class="co"># if NAs are present in data, inform user</span></span>
<span id="cb3-25"><a href="Functions.html#cb3-25" tabindex="-1"></a>  <span class="cf">if</span> ( <span class="fu">nrow</span>(data) <span class="sc">!=</span> <span class="fu">nrow</span>(model_frame) ) {</span>
<span id="cb3-26"><a href="Functions.html#cb3-26" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">nrow</span>(data) <span class="sc">-</span> <span class="fu">nrow</span>(model_frame), <span class="st">&quot; cases removed due to NA values.&quot;</span>)</span>
<span id="cb3-27"><a href="Functions.html#cb3-27" tabindex="-1"></a>  }</span>
<span id="cb3-28"><a href="Functions.html#cb3-28" tabindex="-1"></a>  </span>
<span id="cb3-29"><a href="Functions.html#cb3-29" tabindex="-1"></a>  <span class="co"># warn user if data is particularly small</span></span>
<span id="cb3-30"><a href="Functions.html#cb3-30" tabindex="-1"></a>  <span class="co"># using model_frame to avoid counting NA cases in data</span></span>
<span id="cb3-31"><a href="Functions.html#cb3-31" tabindex="-1"></a>  <span class="cf">if</span> ( <span class="fu">nrow</span>(model_frame) <span class="sc">&lt;</span> 100L ) {</span>
<span id="cb3-32"><a href="Functions.html#cb3-32" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">&quot;Provided `data` may be too small for sampling.&quot;</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-33"><a href="Functions.html#cb3-33" tabindex="-1"></a>  }</span>
<span id="cb3-34"><a href="Functions.html#cb3-34" tabindex="-1"></a></span>
<span id="cb3-35"><a href="Functions.html#cb3-35" tabindex="-1"></a>  <span class="do">### Task Implementation</span></span>
<span id="cb3-36"><a href="Functions.html#cb3-36" tabindex="-1"></a>  <span class="do">### Result Construction</span></span>
<span id="cb3-37"><a href="Functions.html#cb3-37" tabindex="-1"></a>}</span></code></pre></div>
<div style="margin-left:0.5in;margin-right:0.5in;border:1px solid blue;padding:0.1in;">
<p>Notice in the above code that we have opted to save the model frame as a new variable, <code>model_frame</code>. However, if <code>data</code> is large, this is not a good design choice – there will now be two large objects in the environment. Because our focus is only on the structure of functions, we have opted for clarity of variable names over conservation of memory.</p>
</div>
<p><br></p>
<p>Note that each step is heavily documented. Why is the subsequent block of code included? Are there any assumptions we are making? What specifically are we checking? Though some of these documentation lines may seem excessive and may not remain in the final code, they help during development, especially during the development of unit tests.</p>
<p>It may not always be necessary to process or further test inputs before executing the task.</p>
</div>
<div id="task-implementation" class="section level3 hasAnchor" number="1.1.4">
<h3><span class="header-section-number">1.1.4</span> Task Implementation<a href="Functions.html#task-implementation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>At this stage, you should be as confident as possible that the provided inputs are valid and in an expected form. The details of this section of a function depend on the task being implemented, which we will not attempt to cover. Some things to consider as you develop this piece are:</p>
<ul>
<li><strong>Test to ensure that every result is valid before using or returning.</strong> <br> Do values fall within the expected range? Are there NA, NaN, or Inf values? Is the result always going to be the expected type (matrix, vector, list, etc.)?<br />
</li>
<li><strong>Wrap calls to other functions in some type of <code>tryCatch()</code>, <code>be_quiet()</code>, etc.</strong> <br> This allows for more informative messaging to the user (and to developers if debugging is required).</li>
<li><strong>Document!</strong> <br> This cannot be stressed enough! Indicate what you expect the result to be. Describe any non-standard choices you make. The goal of documentation is to provide the <em>next</em> developer with all the information they need to understand exactly what and why.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="Functions.html#cb4-1" tabindex="-1"></a><span class="fu">sampleRegression</span>(formula, data, <span class="at">r.seed =</span> 1234L) {</span>
<span id="cb4-2"><a href="Functions.html#cb4-2" tabindex="-1"></a>  </span>
<span id="cb4-3"><a href="Functions.html#cb4-3" tabindex="-1"></a>  <span class="do">### Input Testing</span></span>
<span id="cb4-4"><a href="Functions.html#cb4-4" tabindex="-1"></a>  </span>
<span id="cb4-5"><a href="Functions.html#cb4-5" tabindex="-1"></a>  <span class="fu">stopifnot</span>(</span>
<span id="cb4-6"><a href="Functions.html#cb4-6" tabindex="-1"></a>    <span class="st">&quot;`formula` should be of the form LHS ~ RHS.&quot;</span> <span class="ot">=</span></span>
<span id="cb4-7"><a href="Functions.html#cb4-7" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">missing</span>(formula) <span class="sc">&amp;&amp;</span> <span class="fu">inherits</span>(formula, <span class="st">&quot;formula&quot;</span>) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(formula) <span class="sc">==</span> 3L,</span>
<span id="cb4-8"><a href="Functions.html#cb4-8" tabindex="-1"></a>    <span class="st">&quot;`data` should be a data.frame.&quot;</span> <span class="ot">=</span> </span>
<span id="cb4-9"><a href="Functions.html#cb4-9" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">missing</span>(data) <span class="sc">&amp;&amp;</span> <span class="fu">is.data.frame</span>(data),</span>
<span id="cb4-10"><a href="Functions.html#cb4-10" tabindex="-1"></a>    <span class="st">&quot;`r.seed` should be a positive integer.&quot;</span> <span class="ot">=</span> </span>
<span id="cb4-11"><a href="Functions.html#cb4-11" tabindex="-1"></a>      <span class="fu">is.numeric</span>(r.seed) <span class="sc">&amp;&amp;</span> <span class="fu">is.vector</span>(r.seed) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(r.seed) <span class="sc">==</span> 1L <span class="sc">&amp;&amp;</span> </span>
<span id="cb4-12"><a href="Functions.html#cb4-12" tabindex="-1"></a>      r.seed <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">isTRUE</span>(<span class="fu">all.equal</span>(r.seed, <span class="fu">as.integer</span>(r.seed)))</span>
<span id="cb4-13"><a href="Functions.html#cb4-13" tabindex="-1"></a>  )</span>
<span id="cb4-14"><a href="Functions.html#cb4-14" tabindex="-1"></a>  </span>
<span id="cb4-15"><a href="Functions.html#cb4-15" tabindex="-1"></a>  <span class="do">### Input Processing </span></span>
<span id="cb4-16"><a href="Functions.html#cb4-16" tabindex="-1"></a>  </span>
<span id="cb4-17"><a href="Functions.html#cb4-17" tabindex="-1"></a>  <span class="co"># check to ensure that all required `formula` terms are provided in `data`</span></span>
<span id="cb4-18"><a href="Functions.html#cb4-18" tabindex="-1"></a>  model_frame <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(stats<span class="sc">::</span><span class="fu">model.frame</span>(formula, data),</span>
<span id="cb4-19"><a href="Functions.html#cb4-19" tabindex="-1"></a>                          <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb4-20"><a href="Functions.html#cb4-20" tabindex="-1"></a>                            <span class="fu">stop</span>(<span class="st">&quot;Unable to extract model.frame.</span><span class="sc">\n\t</span><span class="st">&quot;</span>,</span>
<span id="cb4-21"><a href="Functions.html#cb4-21" tabindex="-1"></a>                                 e<span class="sc">$</span>message, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-22"><a href="Functions.html#cb4-22" tabindex="-1"></a>                          })</span>
<span id="cb4-23"><a href="Functions.html#cb4-23" tabindex="-1"></a>  </span>
<span id="cb4-24"><a href="Functions.html#cb4-24" tabindex="-1"></a>  <span class="co"># if NAs are present in data, inform user</span></span>
<span id="cb4-25"><a href="Functions.html#cb4-25" tabindex="-1"></a>  <span class="cf">if</span> ( <span class="fu">nrow</span>(data) <span class="sc">!=</span> <span class="fu">nrow</span>(model_frame) ) {</span>
<span id="cb4-26"><a href="Functions.html#cb4-26" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">value</span>(<span class="fu">nrow</span>(data) <span class="sc">-</span> <span class="fu">nrow</span>(model_frame)),</span>
<span id="cb4-27"><a href="Functions.html#cb4-27" tabindex="-1"></a>            <span class="st">&quot; cases removed due to NA values.&quot;</span>)</span>
<span id="cb4-28"><a href="Functions.html#cb4-28" tabindex="-1"></a>  }</span>
<span id="cb4-29"><a href="Functions.html#cb4-29" tabindex="-1"></a>  </span>
<span id="cb4-30"><a href="Functions.html#cb4-30" tabindex="-1"></a>  <span class="co"># warn user if data is particularly small</span></span>
<span id="cb4-31"><a href="Functions.html#cb4-31" tabindex="-1"></a>  <span class="co"># using model_frame to avoid possible NA cases in data</span></span>
<span id="cb4-32"><a href="Functions.html#cb4-32" tabindex="-1"></a>  <span class="cf">if</span> ( <span class="fu">nrow</span>(model_frame) <span class="sc">&lt;</span> 100L ) {</span>
<span id="cb4-33"><a href="Functions.html#cb4-33" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">&quot;Provided `data` may be too small for sampling.&quot;</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-34"><a href="Functions.html#cb4-34" tabindex="-1"></a>  }</span>
<span id="cb4-35"><a href="Functions.html#cb4-35" tabindex="-1"></a>  </span>
<span id="cb4-36"><a href="Functions.html#cb4-36" tabindex="-1"></a>  <span class="do">### Task Implementation</span></span>
<span id="cb4-37"><a href="Functions.html#cb4-37" tabindex="-1"></a>  </span>
<span id="cb4-38"><a href="Functions.html#cb4-38" tabindex="-1"></a>  <span class="co"># sample (with replacement) the complete cases data</span></span>
<span id="cb4-39"><a href="Functions.html#cb4-39" tabindex="-1"></a>  data_sample <span class="ot">&lt;-</span> withr<span class="sc">::</span><span class="fu">with_seed</span>(r.seed,</span>
<span id="cb4-40"><a href="Functions.html#cb4-40" tabindex="-1"></a>                                  <span class="fu">sample</span>(<span class="fu">nrow</span>(model_frame), 100L, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb4-41"><a href="Functions.html#cb4-41" tabindex="-1"></a>  </span>
<span id="cb4-42"><a href="Functions.html#cb4-42" tabindex="-1"></a>  <span class="co"># obtain parameter estimates</span></span>
<span id="cb4-43"><a href="Functions.html#cb4-43" tabindex="-1"></a>  <span class="co"># pass-on warnings such as NA coefficients, but stop on error</span></span>
<span id="cb4-44"><a href="Functions.html#cb4-44" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(stats<span class="sc">::</span><span class="fu">lm</span>(formula, model_frame[data_sample, ]),</span>
<span id="cb4-45"><a href="Functions.html#cb4-45" tabindex="-1"></a>                  <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb4-46"><a href="Functions.html#cb4-46" tabindex="-1"></a>                    <span class="fu">stop</span>(<span class="st">&quot;Unable to obtain parameter estimates.</span><span class="sc">\n\t</span><span class="st">&quot;</span>,</span>
<span id="cb4-47"><a href="Functions.html#cb4-47" tabindex="-1"></a>                         e<span class="sc">$</span>message, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-48"><a href="Functions.html#cb4-48" tabindex="-1"></a>                  })</span>
<span id="cb4-49"><a href="Functions.html#cb4-49" tabindex="-1"></a>  </span>
<span id="cb4-50"><a href="Functions.html#cb4-50" tabindex="-1"></a>  <span class="do">### Result Construction</span></span>
<span id="cb4-51"><a href="Functions.html#cb4-51" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="result-construction-and-testing" class="section level3 hasAnchor" number="1.1.5">
<h3><span class="header-section-number">1.1.5</span> Result Construction and Testing<a href="Functions.html#result-construction-and-testing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once a task is complete, you will often need to organize the results and ensure that the values being returned are both valid and match the documentation. Again, the details are task dependent, and we do not attempt to cover those bases here.</p>
<p>For our example, we simply need to add the requested attributes to the value object returned by <code>stats::lm()</code>, i.e., the seed used for the sampling and the random number generator.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="Functions.html#cb5-1" tabindex="-1"></a><span class="fu">sampleRegression</span>(formula, data, <span class="at">r.seed =</span> 1234L) {</span>
<span id="cb5-2"><a href="Functions.html#cb5-2" tabindex="-1"></a>  </span>
<span id="cb5-3"><a href="Functions.html#cb5-3" tabindex="-1"></a>  <span class="do">### Input Testing</span></span>
<span id="cb5-4"><a href="Functions.html#cb5-4" tabindex="-1"></a>  </span>
<span id="cb5-5"><a href="Functions.html#cb5-5" tabindex="-1"></a>  <span class="fu">stopifnot</span>(</span>
<span id="cb5-6"><a href="Functions.html#cb5-6" tabindex="-1"></a>    <span class="st">&quot;`formula` should be of the form LHS ~ RHS.&quot;</span> <span class="ot">=</span></span>
<span id="cb5-7"><a href="Functions.html#cb5-7" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">missing</span>(formula) <span class="sc">&amp;&amp;</span> <span class="fu">inherits</span>(formula, <span class="st">&quot;formula&quot;</span>) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(formula) <span class="sc">==</span> 3L,</span>
<span id="cb5-8"><a href="Functions.html#cb5-8" tabindex="-1"></a>    <span class="st">&quot;`data` should be a data.frame or a soma_adat.&quot;</span> <span class="ot">=</span> </span>
<span id="cb5-9"><a href="Functions.html#cb5-9" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">missing</span>(data) <span class="sc">&amp;&amp;</span> (<span class="fu">is.data.frame</span>(data) <span class="sc">||</span> <span class="fu">is.soma_adat</span>(data)),</span>
<span id="cb5-10"><a href="Functions.html#cb5-10" tabindex="-1"></a>    <span class="st">&quot;`r.seed` should be a positive integer.&quot;</span> <span class="ot">=</span> </span>
<span id="cb5-11"><a href="Functions.html#cb5-11" tabindex="-1"></a>      <span class="fu">is.numeric</span>(r.seed) <span class="sc">&amp;&amp;</span> <span class="fu">is.vector</span>(r.seed) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(r.seed) <span class="sc">==</span> 1L <span class="sc">&amp;&amp;</span> </span>
<span id="cb5-12"><a href="Functions.html#cb5-12" tabindex="-1"></a>      r.seed <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">isTRUE</span>(<span class="fu">all.equal</span>(r.seed, <span class="fu">as.integer</span>(r.seed)))</span>
<span id="cb5-13"><a href="Functions.html#cb5-13" tabindex="-1"></a>  )</span>
<span id="cb5-14"><a href="Functions.html#cb5-14" tabindex="-1"></a>  </span>
<span id="cb5-15"><a href="Functions.html#cb5-15" tabindex="-1"></a>  <span class="do">### Input Processing </span></span>
<span id="cb5-16"><a href="Functions.html#cb5-16" tabindex="-1"></a>  </span>
<span id="cb5-17"><a href="Functions.html#cb5-17" tabindex="-1"></a>  <span class="co"># check to ensure that all required `formula` terms are provided in `data`</span></span>
<span id="cb5-18"><a href="Functions.html#cb5-18" tabindex="-1"></a>  model_frame <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(stats<span class="sc">::</span><span class="fu">model.frame</span>(formula, data),</span>
<span id="cb5-19"><a href="Functions.html#cb5-19" tabindex="-1"></a>                          <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb5-20"><a href="Functions.html#cb5-20" tabindex="-1"></a>                            <span class="fu">stop</span>(<span class="st">&quot;Unable to extract model.frame.</span><span class="sc">\n\t</span><span class="st">&quot;</span>,</span>
<span id="cb5-21"><a href="Functions.html#cb5-21" tabindex="-1"></a>                                 e<span class="sc">$</span>message, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-22"><a href="Functions.html#cb5-22" tabindex="-1"></a>                          })</span>
<span id="cb5-23"><a href="Functions.html#cb5-23" tabindex="-1"></a>  </span>
<span id="cb5-24"><a href="Functions.html#cb5-24" tabindex="-1"></a>  <span class="co"># if NAs are present in data, inform user</span></span>
<span id="cb5-25"><a href="Functions.html#cb5-25" tabindex="-1"></a>  <span class="cf">if</span> ( <span class="fu">nrow</span>(data) <span class="sc">!=</span> <span class="fu">nrow</span>(model_frame) ) {</span>
<span id="cb5-26"><a href="Functions.html#cb5-26" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">value</span>(<span class="fu">nrow</span>(data) <span class="sc">-</span> <span class="fu">nrow</span>(model_frame)),</span>
<span id="cb5-27"><a href="Functions.html#cb5-27" tabindex="-1"></a>            <span class="st">&quot; cases removed due to NA values.&quot;</span>)</span>
<span id="cb5-28"><a href="Functions.html#cb5-28" tabindex="-1"></a>  }</span>
<span id="cb5-29"><a href="Functions.html#cb5-29" tabindex="-1"></a>  </span>
<span id="cb5-30"><a href="Functions.html#cb5-30" tabindex="-1"></a>  <span class="co"># warn user if data is particularly small</span></span>
<span id="cb5-31"><a href="Functions.html#cb5-31" tabindex="-1"></a>  <span class="co"># using model_frame to avoid possible NA cases in data</span></span>
<span id="cb5-32"><a href="Functions.html#cb5-32" tabindex="-1"></a>  <span class="cf">if</span> ( <span class="fu">nrow</span>(model_frame) <span class="sc">&lt;</span> 100L ) {</span>
<span id="cb5-33"><a href="Functions.html#cb5-33" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">&quot;Provided `data` may be too small for sampling.&quot;</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-34"><a href="Functions.html#cb5-34" tabindex="-1"></a>  }</span>
<span id="cb5-35"><a href="Functions.html#cb5-35" tabindex="-1"></a>  </span>
<span id="cb5-36"><a href="Functions.html#cb5-36" tabindex="-1"></a>  <span class="do">### Task Implementation</span></span>
<span id="cb5-37"><a href="Functions.html#cb5-37" tabindex="-1"></a>  </span>
<span id="cb5-38"><a href="Functions.html#cb5-38" tabindex="-1"></a>  <span class="co"># sample (with replacement) the complete cases data</span></span>
<span id="cb5-39"><a href="Functions.html#cb5-39" tabindex="-1"></a>  data_sample <span class="ot">&lt;-</span> withr<span class="sc">::</span><span class="fu">with_seed</span>(r.seed,</span>
<span id="cb5-40"><a href="Functions.html#cb5-40" tabindex="-1"></a>                                  <span class="fu">sample</span>(<span class="fu">nrow</span>(model_frame), 100L, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-41"><a href="Functions.html#cb5-41" tabindex="-1"></a>  </span>
<span id="cb5-42"><a href="Functions.html#cb5-42" tabindex="-1"></a>  <span class="co"># obtain parameter estimates</span></span>
<span id="cb5-43"><a href="Functions.html#cb5-43" tabindex="-1"></a>  <span class="co"># pass-on warnings such as NA coefficients, but stop on error</span></span>
<span id="cb5-44"><a href="Functions.html#cb5-44" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(stats<span class="sc">::</span><span class="fu">lm</span>(formula, model_frame[data_sample, ]),</span>
<span id="cb5-45"><a href="Functions.html#cb5-45" tabindex="-1"></a>                  <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb5-46"><a href="Functions.html#cb5-46" tabindex="-1"></a>                    <span class="fu">stop</span>(<span class="st">&quot;Unable to obtain parameter estimates.</span><span class="sc">\n\t</span><span class="st">&quot;</span>,</span>
<span id="cb5-47"><a href="Functions.html#cb5-47" tabindex="-1"></a>                         e<span class="sc">$</span>message, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-48"><a href="Functions.html#cb5-48" tabindex="-1"></a>                  })</span>
<span id="cb5-49"><a href="Functions.html#cb5-49" tabindex="-1"></a>  </span>
<span id="cb5-50"><a href="Functions.html#cb5-50" tabindex="-1"></a>  <span class="do">### Result Construction and Testing</span></span>
<span id="cb5-51"><a href="Functions.html#cb5-51" tabindex="-1"></a>  </span>
<span id="cb5-52"><a href="Functions.html#cb5-52" tabindex="-1"></a>  <span class="co"># add attributes to fit indicating random generator and seed</span></span>
<span id="cb5-53"><a href="Functions.html#cb5-53" tabindex="-1"></a>  <span class="fu">attr</span>(fit, <span class="st">&quot;RNGkind&quot;</span>) <span class="ot">&lt;-</span> <span class="fu">RNGkind</span>()</span>
<span id="cb5-54"><a href="Functions.html#cb5-54" tabindex="-1"></a>  <span class="fu">attr</span>(fit, <span class="st">&quot;seed&quot;</span>)    <span class="ot">&lt;-</span> r.seed</span>
<span id="cb5-55"><a href="Functions.html#cb5-55" tabindex="-1"></a>  </span>
<span id="cb5-56"><a href="Functions.html#cb5-56" tabindex="-1"></a>  fit</span>
<span id="cb5-57"><a href="Functions.html#cb5-57" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="concluding-remarks" class="section level3 hasAnchor" number="1.1.6">
<h3><span class="header-section-number">1.1.6</span> Concluding Remarks<a href="Functions.html#concluding-remarks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Despite our presentation here, tool development is not a linear process. The procedures for implementing new tools will vary as widely as the types of tools we implement! There are times when it may be easiest to first work out the details of the task itself and then work your way through the remaining components of the function. Or maybe the tool evolves as you develop the details, requiring changes to the original specification as well as the various components. Our object here is not to provide a formula for <em>how</em> to develop code, but to give an ingredients list for what a robust and readable implementation should contain.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="extended-function-example.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Code_Development.pdf", "Code_Development.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
